# Ruff configuration for SHS Technician Analytics Platform
target-version = "py39"
line-length = 100

[lint]
select = [
    "E",      # pycodestyle errors
    "W",      # pycodestyle warnings
    "F",      # Pyflakes
    "I",      # isort
    "B",      # flake8-bugbear
    "C4",     # flake8-comprehensions
    "UP",     # pyupgrade
    "ARG",    # flake8-unused-arguments
    "SIM",    # flake8-simplify
    "TCH",    # flake8-type-checking
    "PTH",    # flake8-use-pathlib
    "ERA",    # eradicate (commented out code)
    "RUF",    # Ruff-specific rules
]

ignore = [
    "E501",   # line too long (handled by formatter)
    "B008",   # do not perform function calls in argument defaults (needed for FastAPI Depends)
    "B904",   # raise without from inside except (too noisy)
    "ARG001", # unused function argument (needed for abstract methods)
]

[lint.per-file-ignores]
"tests/**/*.py" = [
    "ARG",    # unused arguments in tests are fine
    "S101",   # assert is fine in tests
]
"alembic/**/*.py" = [
    "TC002",  # type-checking imports in alembic
    "TC003",  # type-checking imports in alembic
    "UP007",  # Union types in alembic (template-generated)
]
"app/models/*.py" = [
    "ERA001", # allow commented JSON structure documentation
    "TC003",  # uuid import needed at runtime for ForeignKey
    "UP045",  # Optional[] needed for SQLAlchemy on Python 3.9
]
"app/services/ml/*.py" = [
    "TC003",  # Path import needed at runtime
    "UP045",  # Optional[] for Python 3.9 compatibility
]
"app/services/embeddings.py" = [
    "UP045",  # Optional[] for Python 3.9 compatibility
    "SIM108", # Keep explicit if-else for clarity
]
"app/services/tools.py" = [
    "UP045",  # Optional[] for Python 3.9 compatibility
]
"app/services/agent_tools.py" = [
    "UP045",  # Optional[] for Python 3.9 compatibility
]
"app/services/agent.py" = [
    "UP035",  # typing.AsyncGenerator for Python 3.9 compatibility
    "UP045",  # Optional[] for Python 3.9 compatibility
    "SIM102", # Keep nested if for clarity with streaming events
]
"app/services/appliance_tools.py" = [
    "UP045",  # Optional[] for Python 3.9 compatibility
]
"app/schemas/*.py" = [
    "TC003",  # datetime, UUID imports needed at runtime for Pydantic
    "UP045",  # Optional[] for Python 3.9 compatibility
]
"app/routers/*.py" = [
    "TC002",  # redis, AsyncSession needed at runtime for Depends()
    "UP045",  # Optional[] needed for Python 3.9 FastAPI query params
]

[lint.isort]
known-first-party = ["app"]
force-single-line = false
combine-as-imports = true

[format]
quote-style = "double"
indent-style = "space"
skip-magic-trailing-comma = false
line-ending = "auto"
